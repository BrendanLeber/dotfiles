#!/bin/bash

# let's make the script a little more robust
set -u          # exit if the script tries to use an unbound variable
set -e          # exit we a command fails
set -o pipefail # exit if a command in a pipe fails

# check and read the parameters
if [[ !($# -eq 2) ]] && [[ !($# -eq 3) ]]; then
    echo "usage: flac2ogg <FLACFILE> <OGGFILE>"
    exit 1
fi

FLAC=$1
OGG=$2

echo "Encoding $FLAC -> $OGG"

# extract the tags from the flac file
for tag in TITLE ARTIST ALBUM DATE TRACKNUMBER GENRE; do
    eval "$tag=\"`metaflac --show-tag=$tag "$FLAC" | sed 's/.*=//'`\""
done

# start the conversion and include the extracted tags
oggenc --quality 5 --utf8 --discard-comments --output="$OGG" --title "$TITLE" --artist "$ARTIST" --album "$ALBUM" --date "$DATE" --tracknum "$TRACKNUMBER" --genre "$GENRE" "$FLAC"
